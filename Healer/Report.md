Project JX3\_Analysis\_Healer #201702230003

# 剑网三治疗装备属性搭配浅析

私立万花大学杏林医学院卫生统计学教研室助理研究员　花千树

## 1. 引言
　　对PVE治疗与输出而言，如何能够在单位时间内给出尽可能多的治疗/伤害量一直是一个值得研究的问题。我们知道，在一个给定的输出环境中，个体能够输出的总治疗/伤害量与目标剩余血量、个体当前状态以及个体技能选择等因素相关。而配装问题就是与其相关的一个重要的基础问题。本文提出了一个可以用于治疗职业配装的一般性数学模型，并对该模型进行了分析与可视化，在此基础上形成了指导治疗配装的初步结论。

## 2. 装备属性与治疗量的关系
　　首先，我们需要承认，剑三中所有技能/奇穴/心法按照其对应文字描述的方式生效这一基本假设。然后，容易注意到，剑网三的技能描述遵守如下模型：

　　___对目标造成 a + k * SP 伤害/治疗___

　　进一步地，考虑到单个技能在持续输出时受到会心会效等属性的影响，我们有如下关系式：

　　___HPSkill = (a + k * SP) * (1 + CR * (CD - 1))___

　　式中 ___HPSkill___ 代表单个给定技能能够给出的期望治疗量(heal per skill)，___a___ 代表单个给定技能的基本治疗量（即不受治疗成效加成的部分），___k___ 代表技能系数，___SP___ 代表治疗成效(spell power)，___CR___ 代表会心几率(critical rate)，___CD___ 代表会心效果百分比(critical damage)。

　　考虑到给定技能的基本治疗量不受治疗成效影响，并且基本治疗量与技能中受治疗加成的部分相比相差悬殊，出于简化模型的考虑，我们令 ___a = 0___. 除此之外，考虑到所有职业技能的技能系数 ___k___ 为正常数。同时，在假定输出时间无限的情况下，在给定输出手法和输出环境的情况下相同职业各个技能占比应当是恒定的，因此，总可以找到一个给定的正数 ___k'___ 将该职业在该给定输出手法与输出环境下的所有技能等效为一个技能进行输出。考虑到正常数 ___k'___ 并不会改变函数的单调性，出于简化模型的考虑，我们令 ___k' = 1___.

　　另外，基于剪刀石头和布（2015）提出的属性等级与百分比的关系，我们另有如下两个关系式：

　　___CR = CRlevel / 4145___

　　___CD = CDlevel / 1507 + 1.75___

　　式中CRlevel与CDlevel分别是会心等级与会效等级，转换系数做了取整处理。

　　综上所述，我们形成了如下的简化模型：

　　___HPSkill = SP * (1 + CRlevel / 4145 * (CDlevel / 1507 + 0.75))___

## 3. 剑网三治疗装备绿字属性分析

### 3.1 剑网三治疗装备绿字属性构成分析与约束条件的确定
　　在分析简化模型之前，首先需要考虑的是装备的属性构成。有研究者（尼玛啊灬，2015）指出，对于输出装备而言，存在属性与装备分数之间的换算关系。又考虑到给定装备品级的情况下，装备分数是唯一确定的。因此，我们可以推测，在给定装备品级的情况下，不同属性之间存在线性约束关系。

　　为了进一步确定这种线性约束关系中的具体系数，我们采集了不同装备品级、不同属性的装备（除武器）对其附带的绿字属性（即除根骨、体质、内外防以外的属性）进行最小二乘拟合（拟合模型为 ___y = kx___ ，即强制截距为0），得到如下结论（相应数值与分析结果参见项目文件Analysis.xlsx，模型参数在保证误差的前提下进行了一定的舍入）：

　　___CDlevel = Round(CRlevel * 5/11)___

　　___SP = Round(SPmax * 5/9)___

　　___Hastelevel = Round(SPmax * 52/99)___

　　___CRlevel = Round(SPmax * 13/36)___

　　式中Hastelevel代表加速等级，SPmax指同装等纯治疗装备给出的治疗量，Round表示四舍五入到整数位。从上式中我们可以看出：

1. 所有装备的绿字数值均可以换算到纯治疗装备给出的治疗量上
2. 装备给出的治疗量属性加成按照一定的比例（13/11）换算为其他属性（加速或者双会总和）
3. 装备给出的会心数值是会效数值的2.2倍
4. 装备可以转化为其他属性的治疗量是有限的，对于非武器装备而言，最多只能转化同装等纯治疗装备给出治疗量的4/9

　　而对于武器而言，则遵循如下规则：

　　___CDlevel = Round(CRlevel * 5/11)___

　　___SP = Round(SPmax * 88/125)___

　　___Hastelevel = Round(SPmax * 481/1375)___

　　___CRlevel = Round(SPmax * 481/2000)___

　　即除去装备可以转化为其他属性的治疗量上限（对于武器而言是同装等纯治疗装备给出治疗量的37/125）不同以外，武器附带绿字属性的数值转化规律与其他位置的装备等价。出于简化问题的考虑，我们将武器附带绿字属性中的一部分固定为“附加治疗量(SP_add)”，即不允许被重铸为其他属性的治疗量，而将余下的部分作为“可重铸治疗量(SP_recast)”，这部分治疗量可以按照其他装备治疗量重铸的模式重铸为其他属性。通过计算可知：

　　___SP_recast = Round(SPmax * 333/500)___

　　___SP_add = Round(SPmax * 167/500)___

　　进而，不难得出在给定装备分数情况下的绿字属性的约束条件：

　　___CRlevel <= 13/16 * (SPmax - SP) - 11/16 * Hastelevel___

　　___CRlevel >= 0___

　　___SP >= SP_add + 5/9 * (SPmax - SP_add)___

### 3.2 给定某一情形下期望治疗模型的建立与分析
　　确定了装备的属性构成后，进一步地，我们就可以套用模型分析装备绿字属性的选择对于期望治疗量带来的影响。考虑到实际情况较为复杂难以给出一个“混沌”的结果，我们只分析某一类具体情形下装备绿字属性的构成与技能期望治疗之间的关系，另外，注意到不同治疗技能的生效时间不同，因此不考虑加速带来的HPS提升，只考虑加速带来的可行域的变化（即主要比较的是同职业，同附魔/五彩石/小药加成，同加速情况下的纯绿字属性差异带来的影响，不考虑装备插孔的影响）。参照2中给出的基本模型和3.1中确定的装备绿字属性之间的关系，我们建立了如下等式：

　　___HPSkill = (φ * (SP + SP_0) + SP_1) * (1 + (CRlevel + CRlevel_0) / 4145 * ((round(CRlevel / 2.2)+ CDlevel_0) / 1507 + 0.75))___

　　式中SP与CRlevel代表装备绿字属性中给出的治疗量数值与会心等级数值，SP\_0代表通过其他渠道获得的基础治疗量，φ代表职业奇穴获得的常驻型基础治疗量增益，SP\_1代表通过其他渠道获得的非基础治疗量，CRlevel\_0与CDlevel\_0分别代表通过其他渠道获得的会心等级、会心效果等级加成。需要特别注意的是，常驻型增益指能够在整场战斗中稳定存在的增益，即万花的千机奇穴、七秀的剑舞与乞巧奇穴、长歌的棋宫奇穴，五毒的灵蛇献祭与女娲补天由于不能够稳定覆盖全程因此并没有进入比较，参与比较的不同来源加成参数计算方式参见下表：

|:------------:|:------:|:------:|:------:|:--:|
|来源          |基础治疗|会心等级|会效等级|根骨|
|离经易道      |1369    |--      |--      |--  |
|云裳心经      |1400    |--      |--      |--  |
|相知          |1462    |--      |--      |--  |
|补天诀        |1432    |--      |--      |--  |
|乞巧          |+15%    |--      |--      |--  |
|剑舞          |+30%    |--      |--      |--  |
|霜风          |--      |--      |--      |+10%|
|棋宫          |+10%    |--      |--      |--  |
|千机          |+15%    |--      |--      |--  |
|沐风          |--      |--      |301     |--  |
|破苍穹        |--      |207     |150     |--  |
|袖气          |--      |--      |--      |37  |
|五生盘        |--      |74      |--      |--  |
|白信丹        |--      |111     |--      |--  |
|汉宫棋        |--      |--      |--      |27  |
|补心丹        |--      |--      |--      |41  |
|烧尾宴        |--      |--      |--      |39  |
|会会疗（伍）  |138     |41      |81      |--  |
|剑胆（内会）  |--      |49      |--      |--  |
|剑胆（内会效）|--      |--      |49      |--  |
|剑胆（治疗）  |39      |--      |--      |--  |
|风骨（内会）  |--      |68      |--      |--  |
|风骨（内会效）|--      |--      |68      |--  |
|风骨（治疗）  |53      |--      |--      |--  |
|苍安戎（治疗）|19      |--      |--      |--  |

　　另外，根据官方公告（令狐志超，2015）与游戏内对内功心法的说明，每点根骨对属性的加成的计算系数参见下表：

|:------:|:----:|:------:|:------:|
|来源    |治疗量|会心等级|会效等级|
|基础    |0     |0.30    |0.15    |
|离经易道|1.60  |0.15    |0.05    |
|云裳心经|1.70  |0.06    |0.02    |
|相知    |1.65  |0.10    |0.04    |
|补天诀  |1.75  |0       |0       |

　　至此，我们可以根据上述参数计算出某一确定情形下除去装备绿字属性外带来的属性加成，即等式中的SP\_0、φ、SP\_1、CRlevel\_0与CDlevel\_0五个变量。而后，我们对所有门派在1080与1160两个装备等级下的绿字属性收益进行了分析。每个职业每个装等的情形下分别考虑了裸装备、只计附魔（选择会效附魔）与五彩石、只计附魔（选择治疗量附魔）与五彩石、计算全部增益的情形，具体搭配参见下表：

|:------------:|:--:|:------:|:------:|:----:|:--:|:------:|:------:|:----:|
|来源          |1080|1080会效|1080治疗|1080全|1160|1160会效|1160治疗|1160全|
|沐风          |0   |0       |0       |1     |0   |0       |0       |1     |
|破苍穹        |0   |0       |0       |1     |0   |0       |0       |1     |
|袖气          |0   |0       |0       |1     |0   |0       |0       |1     |
|五生盘        |0   |0       |0       |1     |0   |0       |0       |1     |
|白信丹        |0   |0       |0       |1     |0   |0       |0       |1     |
|汉宫棋        |0   |0       |0       |1     |0   |0       |0       |1     |
|补心丹        |0   |0       |0       |1     |0   |0       |0       |1     |
|烧尾宴        |0   |0       |0       |1     |0   |0       |0       |1     |
|会会疗（伍）  |0   |1       |1       |1     |0   |1       |1       |1     |
|剑胆（内会）  |0   |2       |2       |2     |0   |0       |0       |0     |
|剑胆（内会效）|0   |2       |0       |2     |0   |0       |0       |0     |
|剑胆（治疗）  |0   |1       |3       |1     |0   |0       |0       |0     |
|风骨（内会）  |0   |0       |0       |0     |0   |2       |2       |2     |
|风骨（内会效）|0   |0       |0       |0     |0   |2       |0       |2     |
|风骨（治疗）  |0   |0       |0       |0     |0   |1       |3       |1     |
|苍安戎（治疗）|0   |2       |2       |2     |0   |2       |2       |2     |

　　随后，我们对每个职业下的不同加速情形进行了约束，加速选取了当前职业较为主流的三个加速等级：对于五毒，我们选取了0/475/1051，对于七秀，我们选取了318/678/1092，对于长歌，我们选取了0/443/710，对于万花，我们选取了678/945/1092。进一步地，我们将某一具体情形下的约束条件与函数值均标识在自变量投影平面内，绘制出了形如下图的一系列图像（示例图，全图共计32张，参见项目文件optimization.pdf）。

　　从上述图像中我们可以看出：

1. 对于治疗职业而言，在保证给定加速的前提下，尽可能选择提高会心总是一个不坏的选择
2. 对于治疗职业而言，附魔、小药的加成是比较可观的
3. 对于治疗职业而言，护腕与裤子两个位置选择会效附魔的收益要优于选择治疗量附魔的收益，但是相差不大

## 4. 对一般性治疗配装方法的简单讨论

　　至此，我们得出了在某个特定情形下的装备绿字属性选择的分析结论。但是，上述结论的外推是比较有限的，不能对更一般化的配装情形进行讨论。因此，在本文的第四部分，我们试图给出更加一般化的配装辅助工具。在这里，我们分析的目标函数是原始模型的变式：

　　___HPSkill = SP * (1 + CR * (CD - 1))___

　　定义域方面，我们考虑到虽然理论上该函数是可以遍取全体正有理数的，但是进一步考虑到装备属性的可达到性，我们对定义域范围进行了进一步限缩。考虑目前主流装备等级处于1000~1160品范围，我们从1000品面板最低属性计算到了1160品实战实时最高属性，得到了如下的定义域：SP∈[4500, 17000]; CR∈[0.06, 0.76]; CD∈[1.8, 3]. 另外，考虑到该函数无法在三维空间内完全展示，我们绘制了该函数在三维空间内的一组等势面，并以不同的颜色对不同势能面进行了标注，参见下图（动图参见项目文件equipotential.gif）：

　　进一步地，考虑到一般比较难在一个复杂的三维展示图中直观的标识出点面关系，因此我们对上述等势面图进行了切片操作，即分别沿其三个坐标轴（治疗量SP，会心率CR，会心效果CD）将三维图平切，形成一系列的切面图。又考虑到极端属性较难达到，我们在切片时对切面的高度进行了一定的调整，使之在极端位置时的间隔比较稀疏，而在中间的位置比较稠密。进而得到了如下的切面图（示例图，全部切面图参见项目文件topographic\_sliced\_by\_CD.pdf，topographic\_sliced\_by\_CR.pdf，topographic\_sliced\_by\_SP.pdf）：

　　三维等势面图与切面图的作用主要在辅助进行装备选择，一般情况下，我们可以通过这一组切面图上绘制出对应成比例的约束条件进而选择配装方案。如下图所示（参见项目文件topographic\_eg.pdf），下图考虑了在30.21%会心几率下附魔选择的问题，即在此情况下究竟是选择53点治疗量附魔还是选择68点会效附魔。首先，我们需要在图中绘制出约束条件曲线，即___delta_SP = 68/1507*100/53 * delta_CD___, 而后只需要将该曲线沿SP轴方向进行平移即可寻找出在该会心水平下53点治疗量兑换68会效是否“划算”的问题了。不难看出，在图中的直线上，当我们重铸更多的治疗量到会效的时候，能够得到更大的HPSkill，因此我们选择会效附魔。

## 5. 结论

　　本文通过对给定情形下装备绿字属性取舍进行分析，发现：

1. 对于治疗职业而言，在保证给定加速的前提下，尽可能选择提高会心总是一个不坏的选择
2. 对于治疗职业而言，附魔、小药的加成是比较可观的
3. 对于治疗职业而言，护腕与裤子两个位置选择会效附魔的收益要优于选择治疗量附魔的收益，但是相差不大

　　另外，本文根据装备属性与治疗量的一般关系得出了一般化的配装辅助工具，具体参见项目文件topographic\_sliced\_by\_CD.pdf，topographic\_sliced\_by\_CR.pdf，topographic\_sliced\_by\_SP.pdf。

## Acknowledgment
　　感谢饿了么外卖小哥在作者濒临饿死的时候及时送来的外卖，感谢作者导师没催作者任务进度，感谢自家(ji)小歌(hao)苏西寂提供的盛世美颜让作者在充满Deadline的现在还能保持愉悦的心情在这里做一条咸鱼。

## Reference
* 令狐志超. 【红尘宝典】“剑胆琴心“体服4.0.0.7191版本更新公告. http://jx3.bbs.xoyo.com/forum.php?mod=viewthread&tid=33916372
* 剪刀石头和布. 【深夜来一发数据】95级属性等级与百分比对应关系. http://tieba.baidu.com/p/4132253356?see_lz=1
* 尼玛啊灬. 【PVE向】95年代DPS各属性收益分析. http://tieba.baidu.com/p/4159884500?see_lz=1
* 楚玄枫. 【丧心病狂】加速全解密，带你走进最真实的加速世界. http://tieba.baidu.com/p/2715174815?see_lz=1
* 泠落. 加速阈值表格（雕琢版更新） —— 曾经的加速宝典的副产品. http://www.jx3pve.com/thread-5242-1-1.html
* 胖叔叔. 剑网3全职业配装器. https://www.j3pz.com/

## 项目地址
https://github.com/lingxuanxiao/JX3_Analysis.git

## 开放权利
署名-非商业性质使用-相同方式共享